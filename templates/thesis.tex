% LaTeX Template for Master Thesis Literature Review
% Configured for LuaLaTeX with OpenSans font and APA 7th Edition formatting
% Adapted from master-thesis template

\documentclass[
  $if(fontsize)$$fontsize$$else$11pt$endif$,
  a4paper,
  oneside
]{article}

% Encoding and font support for LuaLaTeX
\usepackage{fontspec}

% Font path - fonts in assets folder
\def\fontpath{../assets/fonts/}

% OpenSans font configuration (variable font)
\setmainfont{OpenSans}[
  Path = \fontpath,
  UprightFont = {OpenSans[wdth,wght].ttf},
  ItalicFont = {OpenSans-Italic[wdth,wght].ttf},
  BoldFont = {OpenSans[wdth,wght].ttf},
  BoldItalicFont = {OpenSans-Italic[wdth,wght].ttf},
  BoldFeatures = {Weight=700},
  BoldItalicFeatures = {Weight=700}
]

\setsansfont{OpenSans}[
  Path = \fontpath,
  UprightFont = {OpenSans[wdth,wght].ttf},
  ItalicFont = {OpenSans-Italic[wdth,wght].ttf},
  BoldFont = {OpenSans[wdth,wght].ttf},
  BoldItalicFont = {OpenSans-Italic[wdth,wght].ttf},
  BoldFeatures = {Weight=700},
  BoldItalicFeatures = {Weight=700}
]

\setmonofont{JetBrainsMono}[
  Path = \fontpath,
  UprightFont = {JetBrainsMono[wght].ttf},
  ItalicFont = {JetBrainsMono-Italic[wght].ttf},
  BoldFont = {JetBrainsMono[wght].ttf},
  BoldItalicFont = {JetBrainsMono-Italic[wght].ttf},
  BoldFeatures = {Weight=700},
  BoldItalicFeatures = {Weight=700}
]

% Polyglossia for language support
\usepackage{polyglossia}
\setdefaultlanguage{english}

% Page layout - APA 7 requires 1 inch (2.54cm) margins
\usepackage[
  left=2.54cm,
  right=2.54cm,
  top=2.54cm,
  bottom=2.54cm
]{geometry}

% APA 7: EVERY paragraph should be indented
\usepackage{indentfirst}
\setlength{\parindent}{1.27cm}
\setlength{\parskip}{0pt}

% Ensure indentation
\makeatletter
\let\@afterindentfalse\@afterindenttrue
\@afterindenttrue
\makeatother

% Line spacing - APA 7 requires double spacing
\usepackage{setspace}
\doublespacing

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\thepage}

% Section formatting - APA 7 heading levels
\usepackage{titlesec}
\setcounter{secnumdepth}{0}
\setcounter{tocdepth}{3}

% APA 7 Heading Level 1: Centered, Bold
\titleformat{\section}
  {\normalfont\normalsize\bfseries\centering}
  {\thesection}{1em}{}

% APA 7 Heading Level 2: Left-aligned, Bold
\titleformat{\subsection}
  {\normalfont\normalsize\bfseries\raggedright}
  {\thesubsection}{1em}{}

% APA 7 Heading Level 3: Left-aligned, Bold, Italic
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries\itshape\raggedright}
  {\thesubsubsection}{1em}{}

% Hyperlinks - APA 7: all links should be black
\usepackage[
  colorlinks=true,
  linkcolor=black,
  citecolor=black,
  urlcolor=black,
  pdfusetitle
]{hyperref}

% Graphics support
\usepackage{graphicx}
\usepackage{float}

% Graphics path for figures and logos
\graphicspath{{../figures/ch-explainer/}{../figures/analysis/}{../figures/}{../assets/logos/}}

% Table support
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{calc}
\usepackage{multirow}

% Fix for Pandoc longtable column specifiers
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}

% Table styling
\setlength{\heavyrulewidth}{0.08em}
\setlength{\lightrulewidth}{0.05em}
\setlength{\aboverulesep}{0pt}
\setlength{\belowrulesep}{0pt}
\setlength{\arrayrulewidth}{0.05em}
\setlength{\tabcolsep}{6pt}

% Fix for longtable with specific Pandoc output
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}

% Pandoc 3.x table compatibility
% Define a dummy 'none' counter for Pandoc's table handling
\newcounter{none}

% Allow footnotes in longtable
\usepackage{footnote}
\makesavenoteenv{longtable}
\makeatother

% Scale images to text width by default
\setkeys{Gin}{width=\linewidth,height=\maxheight,keepaspectratio}

% Pandoc 3.x bounded image command
\providecommand{\pandocbounded}[1]{%
  \begin{minipage}{\linewidth}%
    \centering #1%
  \end{minipage}%
}

% List support
\usepackage{enumitem}

% Pandoc tightlist
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Color support
\usepackage{xcolor}

% Caption formatting - APA 7
\usepackage{caption}
\captionsetup{
  font={small,it},
  labelfont={bf,it},
  format=plain,
  justification=raggedright,
  singlelinecheck=false
}

% Code block styling
\usepackage{fvextra}
\usepackage{framed}

% Define Shaded environment for Pandoc code blocks
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}

% Define Highlighting environment
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{
  commandchars=\\\{\},
  fontsize=\small,
  breaklines=true,
}

% Pandoc syntax highlighting commands
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}

% Pandoc variables
$if(title)$
\title{$title$}
$endif$

$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$

$if(date)$
\date{$date$}
$else$
\date{}
$endif$

% Document metadata
\hypersetup{
  pdftitle={$title$},
  pdfauthor={$for(author)$$author$$sep$; $endfor$}
}

% APA 7 Title Page with logos
\makeatletter
\renewcommand{\maketitle}{%
  \begin{titlepage}
    \doublespacing

    % === HEADER: Logos ===
    \noindent
    \begin{minipage}[t]{0.3\textwidth}
      \raggedright
      \includegraphics[height=2.3cm]{th-owl-logo.png}
    \end{minipage}%
    \hfill
    \begin{minipage}[t]{0.3\textwidth}
      \raggedleft
      \includegraphics[height=2.3cm]{mp-logo.png}
    \end{minipage}

    \vspace{6cm}

    % Title
    \centering
    {\bfseries\Large \@title \par}
    \vspace{1.5cm}

    % Author
    {\@author \par}
    \vspace{0.5cm}

    % Affiliation
    $if(institute)$
    {$institute$ \par}
    $endif$
    $if(department)$
    {$department$ \par}
    $endif$
    \vspace{0.75cm}

    % Course info
    $if(course)$
    {$course$ \par}
    $endif$
    $if(instructor)$
    {$instructor$ \par}
    $endif$
    \vspace{0.75cm}

    % Date
    {\@date \par}

    \vfill
  \end{titlepage}
  \setcounter{page}{2}
}
\makeatother

% Begin document
\begin{document}

$if(title)$
\maketitle
\clearpage
$endif$

$if(abstract)$
\begin{abstract}
$abstract$
\end{abstract}
$endif$

$if(toc)$
\tableofcontents
\newpage
$endif$

% Main content
$body$

\end{document}
